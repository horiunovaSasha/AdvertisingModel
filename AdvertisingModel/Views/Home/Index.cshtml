@{
    ViewData["Title"] = "Home Page";
}

<!-- Animated -->
<div class="animated fadeIn">
    <button type="button" class="btn btn-info mb-1" data-toggle="modal" data-target="#mediumModal">
        Змінити функцію q(t)
    </button>
    <button type="button" class="btn btn-info mb-1 float-right" id="changeParams">
       Застосувати нові параметри
    </button>
    <br/>
    <div class="row">
        <span class="col-2">
            <b>r</b>
            <input type="text" value="1.5" id="r_input">
        </span>
        <span class="col-2">
            <b>p</b>
            <input type="text" value="1000" id="p_input">
        </span>
        <span class="col-2">
            <b>c</b>
            <input type="text" value="678" id="c_input">
        </span>
        <span class="col-2">
            <b>a</b>
            <input type="text" value="2000" id="a_input">
        </span>
        <span class="col-2">
            <b>k0</b>
            <input type="text" value="0.65" id="k0_input">
        </span>
        <span class="col-2">
            <b>k1</b>
            <input type="text" value="1.25" id="k1_input">
        </span>
    </div>
    <br />
    <div class="modal fade" id="mediumModal" tabindex="-1" role="dialog" aria-labelledby="mediumModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="mediumModalLabel">Змінити функцію q(t)</h5>
                    <br />
                    <input class="col-12" type="text" value="-2*x + 4x^2/3 - 7" id="funcionInput">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Скасувати</button>
                    <button type="button" id="submitFunctionChange" class="btn btn-primary">Застосувати зміни</button>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12 widget">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Advertising Model</h4>
                    <div id="chartdiv" style="height: 600px"></div>
                </div>
            </div>
        </div>
    </div>

</div>
<!-- .animated -->
@section Scripts {
    <!--Local Stuff-->
    <script>
        $ = jQuery;
        jQuery(document).ready(function ($) {
            "use strict";

        });

        function buildGraph() {
            am4core.ready(function () {
                // Themes begin
                am4core.useTheme(am4themes_animated);
                // Themes end

                var chart = am4core.create("chartdiv", am4charts.XYChart);

                $.ajax({
                    url: "/api/Calculations/Calculate",
                    data: {
                        r: $("#r_input").val(),
                        p: $("#p_input").val(),
                        c: $("#c_input").val(),
                        a: $("#a_input").val(),
                        k0: $("#k0_input").val(),
                        k1: $("#k1_input").val(),
                    }
                })
                .done(function (response) {
                    var data = [];
                    $(response).each(function (index, elem) {
                        var item = {
                            "t": index * 0.01,
                            "y1": elem[0],
                            "y2": elem[1],
                        };

                        if (index % 5 == 0)
                            item.lineColor = chart.colors.next();

                        data.push(item);
                    });

                    chart.data = data;
                })
                .fail(function response() {
                    console.log(response);
                });

                var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
                categoryAxis.renderer.grid.template.location = 0;
                categoryAxis.renderer.ticks.template.disabled = true;
                categoryAxis.renderer.line.opacity = 0;
                categoryAxis.renderer.grid.template.disabled = true;
                categoryAxis.renderer.minGridDistance = 40;
                categoryAxis.dataFields.category = "t";
                categoryAxis.startLocation = 0.4;
                categoryAxis.endLocation = 0.6;


                var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
                valueAxis.tooltip.disabled = true;
                valueAxis.renderer.line.opacity = 0;
                valueAxis.renderer.ticks.template.disabled = true;
                valueAxis.min = 0;

                var lineSeries = chart.series.push(new am4charts.LineSeries());
                lineSeries.dataFields.categoryX = "t";
                lineSeries.dataFields.valueY = "y1";
                lineSeries.tooltipText = "y1: {valueY.value}";
                lineSeries.fillOpacity = 0.5;
                lineSeries.strokeWidth = 3;
                lineSeries.propertyFields.stroke = "lineColor";
                lineSeries.propertyFields.fill = "lineColor";

                var lineSeries1 = chart.series.push(new am4charts.LineSeries());
                lineSeries1.dataFields.categoryX = "t";
                lineSeries1.dataFields.valueY = "y2";
                lineSeries1.tooltipText = "y2: {valueY.value}";
                lineSeries1.fillOpacity = 0.5;
                lineSeries1.strokeWidth = 3;
                lineSeries1.propertyFields.stroke = "lineColor";
                lineSeries1.propertyFields.fill = "lineColor";

                chart.cursor = new am4charts.XYCursor();
                chart.cursor.behavior = "panX";
                chart.cursor.lineX.opacity = 0;
                chart.cursor.lineY.opacity = 0;

                chart.scrollbarX = new am4core.Scrollbar();
                chart.scrollbarX.parent = chart.bottomAxesContainer;

            }); // end am4core.ready()
        }

        buildGraph();

        $('#submitFunctionChange').on('click', function () {
            $.ajax({
                url: "/api/Calculations/ChangeUserFunction",
                data: {
                    textForm: $("#funcionInput").val(),
                },
                success: function (result) {
                    $('#mediumModal').modal('hide');
                    buildGraph();
                }
            });
        });

        $('#changeParams').on('click', function () {
            buildGraph();
        });

    </script>
}